---
title: "Final Homework for Seminar"
author: "HUYNH Vu Thao Nguyen"
date: "10/12/2022"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(xts)
library(lubridate)
library(quantmod)
library(PerformanceAnalytics)
library(ggplot2)
```

## Ice Cream Production Data
Read Data and Rename columns
```{r}
ice_cream <- read.csv('https://raw.githubusercontent.com/ritvikmath/Time-Series-Analysis/master/ice_cream.csv')
colnames(ice_cream) <- c("Date","Production")
head(ice_cream, 10)
```

Convert date column to date-time type, and get data from 2010 onwards.
```{r}
ice_cream$Date = as.Date(ice_cream$Date)
ice_cream_xts <- xts(ice_cream$Production, ice_cream$Date)
ice <- ice_cream_xts["2010-01-01/"]
head(ice, 10)
```

## ACF
```{r}
acf(ice, lag.max = 100, main = "Autocorrelation",
                        col.main = "red",
                        font.main = 4)
```

## PACF
```{r}
pacf(ice, main = "Partial Autocorrelation",
          col.main = "red",
          font.main = 4)
```

## Stock Data
Import data from Yahoo Finance and plot the close price of NYA (New York Stock Exchange).
```{r}
getSymbols("NYA",
           src = 'yahoo',
           from = "2016-1-1",
           to = "2019-1-1",
           auto.assign = TRUE,
           warnings = FALSE
           )

nya_close <- NYA$NYA.Close
plot(nya_close, main = "Stock Price over time (NYA)",
                xlab = "Time",
                ylab = "Price",
                col.main = "red", col.lab = "blue",
                font.main = 4, font.lab = 3)
```

Define First Difference and plot the First Difference over time of NYA.
```{r}
first_diff <- diff(nya_close)
first_diff[is.na(first_diff)] = 0
plot(first_diff, main = "First Difference over time (NYA)",
                xlab = "Time",
                ylab = "Price Difference",
                col.main = "red", col.lab = "blue",
                font.main = 4, font.lab = 3)
```

## ACF
```{r}
acf(first_diff, main = "Autocorrelation",
                        col.main = "red",
                        font.main = 4)
```

## PACF
```{r}
pacf(first_diff, main = "Partial Autocorrelation",
                 col.main = "red",
                 font.main = 4)
```

## Stock Data
Import data from Yahoo Finance and plot the close price of SPY.
```{r}
getSymbols("SPY",
           src = 'yahoo',
           from = "2015-1-1",
           to = "2020-1-1",
           auto.assign = TRUE,
           warnings = FALSE
           )

spy_close <- SPY$SPY.Close
plot(spy_close, main = "Stock Price over time (SPY)",
                xlab = "Time",
                ylab = "Price",
                col.main = "red", col.lab = "blue",
                font.main = 4, font.lab = 3)
```

Define First Difference and plot the First Difference over time of SPY.
```{r}
first_diff <- diff(spy_close)
first_diff[is.na(first_diff)] = 0
plot(first_diff, main = "First Difference over time (SPY)",
                xlab = "Time",
                ylab = "Price Difference",
                col.main = "red", col.lab = "blue",
                font.main = 4, font.lab = 3)
```

## ACF
```{r}
acf(first_diff, main = "Autocorrelation",
                col.main = "red",
                font.main = 4)
```

## PACF
```{r}
pacf(first_diff, main = "Partial Autocorrelation",
                 col.main = "red",
                 font.main = 4)
```

## Stock Returns
This calculates the returns of stock daily of NYA.
```{r}
nya_return <- Return.calculate(
                              nya_close, 
                              method = "discrete"
                              ) 
nya_return1 <-  na.omit(nya_return)
head(nya_return1, 10)
```

To compare with the difference above, the graph of returns look true to me.
```{r}
plot(nya_return1, main = "Stock Returns (NYA)",
                xlab = "Time",
                ylab = "Price Difference",
                col.main = "red", col.lab = "blue",
                font.main = 4, font.lab = 3)
```

## Stock Returns
This calculates the returns of stock daily of SPY.
```{r}
spy_return <- Return.calculate(
                              spy_close, 
                              method = "discrete"
                              ) 
spy_return1 <-  na.omit(spy_return)
head(spy_return1, 10)
```

To compare with the difference above, the graph of returns look true to me.
```{r}
plot(spy_return1, main = "Stock Returns (SPY)",
                xlab = "Time",
                ylab = "Price Difference",
                col.main = "red", col.lab = "blue",
                font.main = 4, font.lab = 3)
```

## AR Model
Ice Cream Production over time using given data and its prediction.
```{r}
train_data <- ice["/2018-12-01"]
test_data <- ice["2019-01-01/"]
model_ar <- ar.ols(train_data, order.max = 3)
pre_ar <- predict(model_ar, n.ahead = 13)

pred_date <- as.xts(zoo(pre_ar$pred, seq(as.Date("2019-01-01"), by = "month", len = 13)))
data_plot <- merge(pred_date, test_data)
autoplot(data_plot, facets = NULL
) +
  geom_line(size = 1.5)+
  ggtitle("Ice Cream Production over the time") +
  labs(y = "Production", x = "Date")

```
